<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra Thi·∫øt B·ªã Si√™u N√¢ng Cao</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress {
            height: 8px;
            background-color: #4caf50;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-6">Ki·ªÉm Tra Thi·∫øt B·ªã Si√™u N√¢ng Cao</h1>
        <div class="mb-4">
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
            <p class="text-sm text-gray-600 mt-1">Ti·∫øn ƒë·ªô ki·ªÉm tra: <span id="progress-text">0%</span></p>
        </div>
        <div id="info-container" class="space-y-6">
            <!-- ƒê·ªô Tin C·∫≠y v√† Tr·∫°ng Th√°i -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">ƒê·ªô Tin C·∫≠y v√† Tr·∫°ng Th√°i</h2>
                <table class="w-full">
                    <tbody>
                        <tr><td class="font-medium">ƒê·ªô Tin C·∫≠y:</td><td id="reliability"><span class="loading-spinner"></span> ƒêang t√≠nh...</td></tr>
                        <tr><td class="font-medium">Tr·∫°ng Th√°i Duy·ªát:</td><td id="approval-status"><span class="loading-spinner"></span> ƒêang ki·ªÉm tra...</td></tr>
                        <tr><td class="font-medium">L√Ω Do:</td><td id="approval-reason"><span class="loading-spinner"></span> ƒêang ki·ªÉm tra...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Ngu·ªìn Truy C·∫≠p -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Ngu·ªìn Truy C·∫≠p</h2>
                <table class="w-full">
                    <tbody id="source-info">
                        <tr><td class="font-medium">ƒê·∫°i L√Ω Ng∆∞·ªùi D√πng:</td><td id="user-agent">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Trang Gi·ªõi Thi·ªáu:</td><td id="referrer">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">ƒê·ªãa Ch·ªâ IP:</td><td id="ip-address">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Lo·∫°i M·∫°ng:</td><td id="network-type">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ti√™u ƒê·ªÅ HTTP:</td><td id="http-headers">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">TLS Fingerprint:</td><td id="tls-fingerprint">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Th√¥ng Tin Thi·∫øt B·ªã -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Th√¥ng Tin Thi·∫øt B·ªã</h2>
                <table class="w-full">
                    <tbody id="device-info">
                        <tr><td class="font-medium">ƒê·ªô Ph√¢n Gi·∫£i M√†n H√¨nh:</td><td id="screen-resolution">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">K√≠ch Th∆∞·ªõc Khung Nh√¨n:</td><td id="viewport-size">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">B·ªô Nh·ªõ Thi·∫øt B·ªã:</td><td id="device-memory">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">S·ªë L√µi CPU:</td><td id="cpu-cores">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Tr·∫°ng Th√°i Pin:</td><td id="battery-status">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">H·ªó Tr·ª£ C·∫£m ·ª®ng:</td><td id="touch-support">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Th√¥ng Tin Tr√¨nh Duy·ªát -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Th√¥ng Tin Tr√¨nh Duy·ªát</h2>
                <table class="w-full">
                    <tbody id="browser-info">
                        <tr><td class="font-medium">Nh√† Cung C·∫•p WebGL:</td><td id="webgl-vendor">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">B·ªô X·ª≠ L√Ω WebGL:</td><td id="webgl-renderer">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">T·∫ßn S·ªë M·∫´u √Çm Thanh:</td><td id="audio-sample-rate">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">D·∫•u V√¢n Tay √Çm Thanh:</td><td id="audio-fingerprint">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ng√¥n Ng·ªØ:</td><td id="languages">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Cookie ƒê∆∞·ª£c B·∫≠t:</td><td id="cookies-enabled">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">B·ªô Nh·ªõ C·ª•c B·ªô:</td><td id="local-storage">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">D·∫•u V√¢n Tay Canvas:</td><td id="canvas-fingerprint">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Client Hints:</td><td id="client-hints">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Th√¥ng Tin M·∫°ng -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Th√¥ng Tin M·∫°ng</h2>
                <table class="w-full">
                    <tbody id="network-info">
                        <tr><td class="font-medium">Lo·∫°i K·∫øt N·ªëi:</td><td id="connection-type">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Th·ªùi Gian Ph·∫£n H·ªìi:</td><td id="rtt">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">T·ªëc ƒê·ªô T·∫£i Xu·ªëng:</td><td id="downlink">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ti·∫øt Ki·ªám D·ªØ Li·ªáu:</td><td id="save-data">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">ƒê·ªô Tr·ªÖ M·∫°ng:</td><td id="network-latency">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Ph√¢n T√≠ch Si√™u N√¢ng Cao -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Ph√¢n T√≠ch Si√™u N√¢ng Cao</h2>
                <table class="w-full">
                    <tbody id="advanced-info">
                        <tr><td class="font-medium">D·∫•u V√¢n Tay WebGL:</td><td id="webgl-fingerprint">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">D·∫•u V√¢n Tay WebRTC:</td><td id="webrtc-fingerprint">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">C·∫£m Bi·∫øn Thi·∫øt B·ªã:</td><td id="device-sensors">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Hi·ªáu Su·∫•t CPU/GPU:</td><td id="performance-benchmark">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Danh S√°ch Plugin:</td><td id="navigator-plugins">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">M√∫i Gi·ªù:</td><td id="timezone-offset">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ph√¥ng Ch·ªØ M·ªü R·ªông:</td><td id="extended-fonts">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Navigator Properties:</td><td id="navigator-props">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">WebGL Shader Precision:</td><td id="webgl-shader">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Cross-Device Patterns:</td><td id="cross-device">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Ph√¢n T√≠ch H√†nh Vi -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Ph√¢n T√≠ch H√†nh Vi</h2>
                <table class="w-full">
                    <tbody id="behavior-info">
                        <tr><td class="font-medium">S·ªë L·∫ßn Ch·∫°m:</td><td id="touch-count">0</td></tr>
                        <tr><td class="font-medium">T·ªëc ƒê·ªô Ch·∫°m Trung B√¨nh:</td><td id="touch-speed">ƒêang ghi...</td></tr>
                        <tr><td class="font-medium">√Åp L·ª±c Ch·∫°m:</td><td id="touch-pressure">ƒêang ghi...</td></tr>
                        <tr><td class="font-medium">T√≠nh Ng·∫´u Nhi√™n:</td><td id="touch-randomness">ƒêang ghi...</td></tr>
                        <tr><td class="font-medium">Chu·ªôt Di Chuy·ªÉn Entropy:</td><td id="mouse-entropy">ƒêang ghi...</td></tr>
                        <tr><td class="font-medium">T·ªëc ƒê·ªô G√µ Ph√≠m:</td><td id="typing-speed">ƒêang ghi...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Th√¥ng Tin Kh√°c -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-2">Th√¥ng Tin Kh√°c</h2>
                <table class="w-full">
                    <tbody id="other-info">
                        <tr><td class="font-medium">WebRTC ƒê∆∞·ª£c B·∫≠t:</td><td id="webrtc-enabled">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ph√¥ng Ch·ªØ Ph√°t Hi·ªán:</td><td id="fonts-detected">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">N·ªÅn T·∫£ng:</td><td id="platform">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Kh√¥ng Theo D√µi:</td><td id="do-not-track">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Webdriver:</td><td id="webdriver">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">V·ªã Tr√≠:</td><td id="geolocation">ƒêang t·∫£i...</td></tr>
                        <tr><td class="font-medium">Ph√°t Hi·ªán Gian L·∫≠n:</td><td id="fraud-detection">ƒêang t·∫£i...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Progress tracking
        let totalChecks = 40;
        let completedChecks = 0;
        function updateProgress() {
            completedChecks++;
            const percentage = Math.min((completedChecks / totalChecks) * 100, 100);
            document.getElementById('progress').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${Math.round(percentage)}%`;
        }

        // H√†m h·ªó tr·ª£ c·∫≠p nh·∫≠t DOM
        function updateElement(id, value) {
            const element = document.getElementById(id);
            element.innerHTML = value || 'Kh√¥ng kh·∫£ d·ª•ng';
            element.querySelector('.loading-spinner')?.remove();
            updateProgress();
        }

        // H√†m t√≠nh ƒë·ªô tin c·∫≠y
        function calculateReliability() {
            let score = 0;

            // User Agent (8 ƒëi·ªÉm)
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = userAgent.includes('mobile') || userAgent.includes('android') || userAgent.includes('iphone') || userAgent.includes('ipad');
            score += isMobile && !userAgent.includes('bot') ? 8 : 2;

            // H·ªó tr·ª£ c·∫£m ·ª©ng (8 ƒëi·ªÉm)
            const touchPoints = navigator.maxTouchPoints || 0;
            score += touchPoints > 0 ? 8 : 0;

            // ƒê·ªô ph√¢n gi·∫£i m√†n h√¨nh (7 ƒëi·ªÉm)
            const screenWidth = screen.width;
            const screenHeight = screen.height;
            const isPhoneScreen = (screenWidth >= 320 && screenWidth <= 1440) && (screenHeight >= 480 && screenHeight <= 3200);
            score += isPhoneScreen ? 7 : 2;

            // Tr·∫°ng th√°i pin (7 ƒëi·ªÉm)
            const hasBattery = !!navigator.getBattery;
            score += hasBattery ? 7 : 2;

            // WebGL (7 ƒëi·ªÉm)
            const gl = document.createElement('canvas').getContext('webgl2') || document.createElement('canvas').getContext('webgl');
            const hasWebGL = !!gl;
            let webGLValid = false;
            if (hasWebGL) {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : '';
                webGLValid = renderer.includes('Adreno') || renderer.includes('Mali') || renderer.includes('Apple') || renderer.includes('PowerVR');
            }
            score += hasWebGL && webGLValid ? 7 : 2;

            // K·∫øt n·ªëi m·∫°ng (7 ƒëi·ªÉm)
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            const hasConnection = !!connection;
            const validConnection = hasConnection && ['slow-2g', '2g', '3g', '4g', 'wifi'].includes(connection.effectiveType);
            score += hasConnection && validConnection ? 7 : 2;

            // Audio Context (6 ƒëi·ªÉm)
            const AudioContext2 = window.AudioContext || window.webkitAudioContext;
            const hasAudio = !!AudioContext2;
            let audioValid = false;
            if (hasAudio) {
                const ctx = new AudioContext2();
                audioValid = [44100, 48000].includes(ctx.sampleRate);
                ctx.close();
            }
            score += hasAudio && audioValid ? 6 : 2;

            // WebRTC (6 ƒëi·ªÉm)
            const hasWebRTC = !!(window.RTCPeerConnection || window.webkitRTCPeerConnection);
            score += hasWebRTC ? 6 : 2;

            // C·∫£m bi·∫øn thi·∫øt b·ªã (6 ƒëi·ªÉm)
            const hasSensors = !!(window.DeviceOrientationEvent || window.DeviceMotionEvent || navigator.vibrate);
            score += hasSensors ? 6 : 2;

            // Hi·ªáu su·∫•t CPU/GPU (6 ƒëi·ªÉm)
            let performanceScore = 0;
            const start = performance.now();
            for (let i = 0; i < 2000000; i++) Math.sin(Math.random());
            const end = performance.now();
            const duration = end - start;
            performanceScore = duration < 150 ? 6 : duration < 300 ? 4 : 2;
            score += performanceScore;

            // Navigator Plugins (5 ƒëi·ªÉm)
            const plugins = navigator.plugins ? Array.from(navigator.plugins).map(p => p.name) : [];
            const hasFewPlugins = plugins.length <= 2;
            score += hasFewPlugins ? 5 : 2;

            // M√∫i gi·ªù/IP (5 ƒëi·ªÉm)
            const timezoneOffset = new Date().getTimezoneOffset();
            const isValidTimezone = timezoneOffset >= -720 && timezoneOffset <= 720;
            score += isValidTimezone ? 5 : 2;

            // Client Hints (5 ƒëi·ªÉm)
            const hasClientHints = !!navigator.userAgentData;
            score += hasClientHints ? 5 : 2;

            // Font Fingerprinting (5 ƒëi·ªÉm)
            const fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia', 'Comic Sans MS', 'Roboto', 'Open Sans', 'Lato'];
            const hasFonts = detectFonts(fonts).length > 0;
            score += hasFonts ? 5 : 2;

            // H√†nh vi c·∫£m ·ª©ng/chu·ªôt (5 ƒëi·ªÉm)
            let behaviorScore = touchEvents.length > 0 ? (isTouchBehaviorNatural() ? 5 : 3) : 2;
            score += behaviorScore;

            // TLS Fingerprint (5 ƒëi·ªÉm)
            score += tlsFingerprint ? 5 : 2;

            // WebGL Shader Precision (5 ƒëi·ªÉm)
            const hasShaderPrecision = gl && gl.getShaderPrecisionFormat;
            score += hasShaderPrecision ? 5 : 2;

            // Cross-Device Consistency (5 ƒëi·ªÉm)
            const hasCrossDevice = sessionStorage.getItem('sessionPatterns') !== null;
            score += hasCrossDevice ? 5 : 2;

            // Ph√°t hi·ªán gian l·∫≠n (5 ƒëi·ªÉm)
            score += fraudScore > 0.8 ? 5 : fraudScore > 0.5 ? 3 : 1;

            return Math.min(score, 100);
        }

        // H√†m ki·ªÉm tra duy·ªát thi·∫øt b·ªã
        function checkApproval(reliability) {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = userAgent.includes('mobile') || userAgent.includes('android') || userAgent.includes('iphone') || userAgent.includes('ipad');
            const touchPoints = navigator.maxTouchPoints || 0;
            const webdriver = navigator.webdriver || false;
            const plugins = navigator.plugins ? Array.from(navigator.plugins).map(p => p.name) : [];
            const hasFewPlugins = plugins.length <= 2;
            const hasSensors = !!(window.DeviceOrientationEvent || window.DeviceMotionEvent || navigator.vibrate);
            const isNaturalBehavior = touchEvents.length > 0 ? isTouchBehaviorNatural() : false;
            const isValidWebGL = calculateReliability() >= 90; // Ki·ªÉm tra WebGL h·ª£p l·ªá
            const isConsistent = fraudScore > 0.8;

            if (isMobile && touchPoints > 0 && reliability >= 90 && !webdriver && hasFewPlugins && hasSensors && isNaturalBehavior && isValidWebGL && isConsistent) {
                return { approved: true, reason: 'Thi·∫øt b·ªã ƒë∆∞·ª£c x√°c ƒë·ªãnh l√† ƒëi·ªán tho·∫°i th·∫≠t v·ªõi h√†nh vi t·ª± nhi√™n v√† t√≠n hi·ªáu nh·∫•t qu√°n.' };
            } else {
                let reason = 'Thi·∫øt b·ªã kh√¥ng ƒë∆∞·ª£c duy·ªát v√¨: ';
                if (!isMobile) reason += 'Kh√¥ng ph·∫£i tr√¨nh duy·ªát di ƒë·ªông. ';
                if (touchPoints === 0) reason += 'Kh√¥ng h·ªó tr·ª£ c·∫£m ·ª©ng. ';
                if (reliability < 90) reason += 'ƒê·ªô tin c·∫≠y th·∫•p. ';
                if (webdriver) reason += 'Ph√°t hi·ªán gi·∫£ l·∫≠p (webdriver). ';
                if (!hasFewPlugins) reason += 'Qu√° nhi·ªÅu plugin b·∫•t th∆∞·ªùng. ';
                if (!hasSensors) reason += 'Thi·∫øu h·ªó tr·ª£ c·∫£m bi·∫øn thi·∫øt b·ªã. ';
                if (!isNaturalBehavior) reason += 'H√†nh vi c·∫£m ·ª©ng kh√¥ng t·ª± nhi√™n, nghi ng·ªù bot. ';
                if (!isValidWebGL) reason += 'WebGL kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√°ng ng·ªù. ';
                if (!isConsistent) reason += 'T√≠n hi·ªáu kh√¥ng nh·∫•t qu√°n, c√≥ th·ªÉ b·ªã gi·∫£ m·∫°o. ';
                return { approved: false, reason };
            }
        }

        // Ph√°t hi·ªán gian l·∫≠n ƒë∆°n gi·∫£n
        let fraudScore = 1;
        function detectFraud() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = userAgent.includes('mobile') || userAgent.includes('android') || userAgent.includes('iphone') || userAgent.includes('ipad');
            const gl = document.createElement('canvas').getContext('webgl2') || document.createElement('canvas').getContext('webgl');
            const debugInfo = gl?.getExtension('WEBGL_debug_renderer_info');
            const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : '';
            const isSuspiciousWebGL = !renderer.includes('Adreno') && !renderer.includes('Mali') && !renderer.includes('Apple') && !renderer.includes('PowerVR');
            const touchPoints = navigator.maxTouchPoints || 0;
            const hasSensors = !!(window.DeviceOrientationEvent || window.DeviceMotionEvent);
            const timezoneOffset = new Date().getTimezoneOffset();
            const isValidTimezone = timezoneOffset >= -720 && timezoneOffset <= 720;
            const hasClientHints = !!navigator.userAgentData;

            fraudScore = 1;
            if (!isMobile) fraudScore *= 0.9;
            if (isSuspiciousWebGL) fraudScore *= 0.8;
            if (touchPoints === 0) fraudScore *= 0.7;
            if (!hasSensors) fraudScore *= 0.8;
            if (!isValidTimezone) fraudScore *= 0.9;
            if (!hasClientHints) fraudScore *= 0.9;
            if (touchEvents.length > 0 && !isTouchBehaviorNatural()) fraudScore *= 0.7;
            if (mouseEvents.length > 0 && !isMouseBehaviorNatural()) fraudScore *= 0.8;

            updateElement('fraud-detection', `ƒêi·ªÉm gian l·∫≠n: ${(fraudScore * 100).toFixed(2)}% (C√†ng cao c√†ng ƒë√°ng tin)`);
        }

        // Ph√¢n t√≠ch h√†nh vi c·∫£m ·ª©ng
        let touchEvents = [];
        document.addEventListener('touchstart', e => {
            touchEvents.push({
                time: Date.now(),
                x: e.touches[0].clientX,
                y: e.touches[0].clientY,
                pressure: e.touches[0].force || 0,
                angle: e.touches[0].rotationAngle || 0
            });
            updateElement('touch-count', touchEvents.length);
            updateTouchBehavior();
            detectFraud();
        });

        function isTouchBehaviorNatural() {
            if (touchEvents.length < 2) return false;
            let speeds = [], pressures = [], randomness = 0;
            for (let i = 1; i < touchEvents.length; i++) {
                const dx = touchEvents[i].x - touchEvents[i-1].x;
                const dy = touchEvents[i].y - touchEvents[i-1].y;
                const dt = touchEvents[i].time - touchEvents[i-1].time;
                const speed = Math.sqrt(dx*dx + dy*dy) / dt;
                speeds.push(speed);
                pressures.push(touchEvents[i].pressure);
                randomness += Math.abs(dx) + Math.abs(dy);
            }
            const avgSpeed = speeds.reduce((a, b) => a + b, 0) / speeds.length;
            const avgPressure = pressures.reduce((a, b) => a + b, 0) / pressures.length;
            return avgSpeed > 0.1 && avgSpeed < 2 && avgPressure > 0 && randomness > 50;
        }

        function updateTouchBehavior() {
            if (touchEvents.length < 2) return;
            const speeds = touchEvents.slice(1).map((e, i) => {
                const dx = e.x - touchEvents[i].x;
                const dy = e.y - touchEvents[i].y;
                const dt = e.time - touchEvents[i].time;
                return Math.sqrt(dx*dx + dy*dy) / dt;
            });
            const avgSpeed = speeds.reduce((a, b) => a + b, 0) / speeds.length;
            const avgPressure = touchEvents.reduce((a, b) => a + b.pressure, 0) / touchEvents.length;
            const randomness = touchEvents.reduce((a, e, i) => i > 0 ? a + Math.abs(e.x - touchEvents[i-1].x) + Math.abs(e.y - touchEvents[i-1].y) : a, 0);
            updateElement('touch-speed', `${avgSpeed.toFixed(2)} px/ms`);
            updateElement('touch-pressure', `${avgPressure.toFixed(2)}`);
            updateElement('touch-randomness', `${randomness.toFixed(2)} px`);
        }

        // Ph√¢n t√≠ch h√†nh vi chu·ªôt
        let mouseEvents = [];
        document.addEventListener('mousemove', e => {
            mouseEvents.push({
                time: Date.now(),
                x: e.clientX,
                y: e.clientY,
                movementX: e.movementX,
                movementY: e.movementY
            });
            updateMouseBehavior();
            detectFraud();
        });

        function isMouseBehaviorNatural() {
            if (mouseEvents.length < 10) return false;
            let entropy = 0;
            for (let i = 1; i < mouseEvents.length; i++) {
                const dx = mouseEvents[i].x - mouseEvents[i-1].x;
                const dy = mouseEvents[i].y - mouseEvents[i-1].y;
                entropy += Math.abs(dx) + Math.abs(dy);
            }
            return entropy > 100;
        }

        function updateMouseBehavior() {
            if (mouseEvents.length < 10) return;
            let entropy = 0;
            for (let i = 1; i < mouseEvents.length; i++) {
                const dx = mouseEvents[i].x - mouseEvents[i-1].x;
                const dy = mouseEvents[i].y - mouseEvents[i-1].y;
                entropy += Math.abs(dx) + Math.abs(dy);
            }
            updateElement('mouse-entropy', `${entropy.toFixed(2)} px`);
        }

        // Ph√¢n t√≠ch t·ªëc ƒë·ªô g√µ ph√≠m
        let keyEvents = [];
        document.addEventListener('keydown', e => {
            keyEvents.push({
                time: Date.now(),
                key: e.key
            });
            updateTypingBehavior();
        });

        function updateTypingBehavior() {
            if (keyEvents.length < 2) return;
            const intervals = keyEvents.slice(1).map((e, i) => e.time - keyEvents[i].time);
            const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
            updateElement('typing-speed', `${(1000 / avgInterval).toFixed(2)} ph√≠m/gi√¢y`);
        }

        // C·∫≠p nh·∫≠t ƒë·ªô tin c·∫≠y v√† tr·∫°ng th√°i duy·ªát
        setTimeout(() => {
            const reliability = calculateReliability();
            const approval = checkApproval(reliability);
            updateElement('reliability', `${reliability}%`);
            updateElement('approval-status', approval.approved ? 'ƒê∆∞·ª£c duy·ªát' : 'Kh√¥ng ƒë∆∞·ª£c duy·ªát');
            updateElement('approval-reason', approval.reason);
        }, 3000);

        // Ngu·ªìn Truy C·∫≠p
        updateElement('user-agent', navigator.userAgent);
        updateElement('referrer', document.referrer || 'Kh√¥ng c√≥');
        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => updateElement('ip-address', data.ip || 'Kh√¥ng x√°c ƒë·ªãnh'))
            .catch(() => updateElement('ip-address', 'Kh√¥ng th·ªÉ l·∫•y IP, ki·ªÉm tra k·∫øt n·ªëi'));

        // TLS Fingerprint (gi·∫£ l·∫≠p)
        let tlsFingerprint = null;
        function getTLSFingerprint() {
            // Gi·∫£ l·∫≠p TLS ClientHello (th·ª±c t·∫ø c·∫ßn server-side ho·∫∑c WebRTC)
            const possibleCiphers = ['TLS_AES_128_GCM_SHA256', 'TLS_AES_256_GCM_SHA384', 'TLS_CHACHA20_POLY1305_SHA256'];
            const possibleExtensions = ['server_name', 'supported_groups', 'signature_algorithms'];
            tlsFingerprint = `Ciphers: ${possibleCiphers.join(', ')}; Extensions: ${possibleExtensions.join(', ')}`;
            updateElement('tls-fingerprint', tlsFingerprint);
        }
        getTLSFingerprint();

        // Th√¥ng Tin Thi·∫øt B·ªã
        updateElement('screen-resolution', `${screen.width}x${screen.height} (ƒê·ªô s√¢u m√†u: ${screen.colorDepth})`);
        updateElement('viewport-size', `${window.innerWidth}x${window.innerHeight}`);
        updateElement('device-memory', navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Kh√¥ng h·ªó tr·ª£');
        updateElement('cpu-cores', navigator.hardwareConcurrency || 'Kh√¥ng kh·∫£ d·ª•ng');
        updateElement('touch-support', navigator.maxTouchPoints > 0 ? `C√≥ (${navigator.maxTouchPoints} ƒëi·ªÉm)` : 'Kh√¥ng');

        // Tr·∫°ng Th√°i Pin
        if (navigator.getBattery) {
            navigator.getBattery().then(battery => {
                updateElement('battery-status', 
                    `${(battery.level * 100).toFixed(0)}% (${battery.charging ? 'ƒêang s·∫°c' : 'Kh√¥ng s·∫°c'})`);
            }).catch(() => updateElement('battery-status', 'L·ªói truy c·∫≠p pin'));
        } else {
            updateElement('battery-status', 'Kh√¥ng h·ªó tr·ª£');
        }

        // Th√¥ng Tin Tr√¨nh Duy·ªát
        const gl = document.createElement('canvas').getContext('webgl2') || document.createElement('canvas').getContext('webgl');
        if (gl) {
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            updateElement('webgl-vendor', debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Kh√¥ng kh·∫£ d·ª•ng');
            updateElement('webgl-renderer', debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Kh√¥ng kh·∫£ d·ª•ng');
        } else {
            updateElement('webgl-vendor', 'Kh√¥ng h·ªó tr·ª£');
            updateElement('webgl-renderer', 'Kh√¥ng h·ªó tr·ª£');
        }

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (AudioContext) {
            const ctx = new AudioContext();
            updateElement('audio-sample-rate', `${ctx.sampleRate} Hz`);
            ctx.close();
        } else {
            updateElement('audio-sample-rate', 'Kh√¥ng h·ªó tr·ª£');
        }

        // D·∫•u V√¢n Tay √Çm Thanh N√¢ng Cao
        function getAdvancedAudioFingerprint() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) {
                updateElement('audio-fingerprint', 'Kh√¥ng h·ªó tr·ª£');
                return;
            }
            const ctx = new AudioContext();
            const oscillator = ctx.createOscillator();
            const compressor = ctx.createDynamicsCompressor();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
            compressor.threshold.setValueAtTime(-50, ctx.currentTime);
            oscillator.connect(compressor);
            compressor.connect(ctx.destination);
            oscillator.start();
            setTimeout(() => {
                oscillator.stop();
                const fingerprint = `Sample Rate: ${ctx.sampleRate}, Latency: ${ctx.baseLatency}, Compressor: ${compressor.threshold.value}`;
                updateElement('audio-fingerprint', fingerprint);
                ctx.close();
            }, 100);
        }
        getAdvancedAudioFingerprint();

        updateElement('languages', navigator.languages ? navigator.languages.join(', ') : navigator.language);
        updateElement('cookies-enabled', navigator.cookieEnabled ? 'C√≥' : 'Kh√¥ng');
        updateElement('local-storage', window.localStorage ? 'Kh·∫£ d·ª•ng' : 'Kh√¥ng kh·∫£ d·ª•ng');

        // D·∫•u V√¢n Tay Canvas N√¢ng Cao
        function getAdvancedCanvasFingerprint() {
            const canvas = document.createElement('canvas');
            canvas.width = 300;
            canvas.height = 150;
            const ctx = canvas.getContext('2d');
            ctx.font = '18px Arial';
            ctx.fillStyle = 'rgb(255,0,0)';
            ctx.fillText('Ki·ªÉm Tra D·∫•u V√¢n Tay Si√™u N√¢ng Cao üòéüöÄ', 2, 20);
            const gradient = ctx.createLinearGradient(0, 0, 300, 0);
            gradient.addColorStop(0, 'blue');
            gradient.addColorStop(1, 'green');
            ctx.fillStyle = gradient;
            ctx.fillRect(20, 30, 260, 60);
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 10;
            ctx.fillStyle = 'yellow';
            ctx.fillText('Shadow & Emoji Test', 30, 80);
            ctx.globalCompositeOperation = 'multiply';
            ctx.fillStyle = 'rgba(255,0,255,0.5)';
            ctx.fillRect(50, 90, 200, 50);
            return canvas.toDataURL().substring(0, 50) + '...';
        }
        updateElement('canvas-fingerprint', getAdvancedCanvasFingerprint());

        // Client Hints
        if (navigator.userAgentData) {
            navigator.userAgentData.getHighEntropyValues(['platform', 'model', 'mobile', 'architecture', 'bitness', 'brands']).then(hints => {
                updateElement('client-hints', JSON.stringify(hints, null, 2));
            }).catch(() => updateElement('client-hints', 'L·ªói truy c·∫≠p client hints'));
        } else {
            updateElement('client-hints', 'Kh√¥ng h·ªó tr·ª£');
        }

        // Ph√¢n T√≠ch Si√™u N√¢ng Cao
        // D·∫•u V√¢n Tay WebGL N√¢ng Cao
        function getAdvancedWebGLFingerprint() {
            if (!gl) return 'Kh√¥ng h·ªó tr·ª£';
            const extensions = gl.getSupportedExtensions().join(', ');
            const program = gl.createProgram();
            const vertexShader = gl.createShader(gl.VERTEX_SHADER);
            const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(vertexShader, 'void main() { gl_Position = vec4(0.0, 0.0, 0.0, 1.0); }');
            gl.shaderSource(fragmentShader, 'void main() { gl_FragColor = vec4(1.0, 0.5, 0.0, 1.0); }');
            gl.compileShader(vertexShader);
            gl.compileShader(fragmentShader);
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            gl.useProgram(program);
            const pixels = new Uint8Array(4);
            gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);
            return `Pixels: ${pixels.join(',')}, Extensions: ${extensions.substring(0, 50)}...`;
        }
        updateElement('webgl-fingerprint', getAdvancedWebGLFingerprint());

        // WebGL Shader Precision
        function getWebGLShaderPrecision() {
            if (!gl) return 'Kh√¥ng h·ªó tr·ª£';
            const vertexPrecision = gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT);
            const fragmentPrecision = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);
            return `Vertex: ${vertexPrecision.precision}, Fragment: ${fragmentPrecision.precision}`;
        }
        updateElement('webgl-shader', getWebGLShaderPrecision());

        // D·∫•u V√¢n Tay WebRTC N√¢ng Cao
        function getAdvancedWebRTCFingerprint() {
            if (!window.RTCPeerConnection && !window.webkitRTCPeerConnection) {
                updateElement('webrtc-fingerprint', 'Kh√¥ng h·ªó tr·ª£');
                return;
            }
            const RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
            const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
            let fingerprint = 'ICE: ';
            pc.createDataChannel('test');
            pc.createOffer().then(offer => {
                pc.setLocalDescription(offer);
                fingerprint += `SDP: ${offer.sdp.substring(0, 50)}... `;
                const sdpLines = offer.sdp.split('\n');
                const codecs = sdpLines.filter(line => line.includes('a=rtpmap')).join('; ');
                fingerprint += `Codecs: ${codecs.substring(0, 50)}...`;
            });
            pc.onicecandidate = event => {
                if (event.candidate) {
                    fingerprint += event.candidate.candidate.substring(0, 50) + '; ';
                }
            };
            setTimeout(() => {
                updateElement('webrtc-fingerprint', fingerprint || 'Kh√¥ng thu th·∫≠p ƒë∆∞·ª£c');
                pc.close();
            }, 1500);
            return 'ƒêang thu th·∫≠p...';
        }
        updateElement('webrtc-fingerprint', getAdvancedWebRTCFingerprint());

        // C·∫£m Bi·∫øn Thi·∫øt B·ªã
        let sensorData = 'Kh√¥ng ph√°t hi·ªán';
        if (window.DeviceOrientationEvent || window.DeviceMotionEvent || navigator.vibrate) {
            window.addEventListener('deviceorientation', event => {
                sensorData = `ƒê·ªãnh h∆∞·ªõng: Alpha=${event.alpha?.toFixed(2)}, Beta=${event.beta?.toFixed(2)}, Gamma=${event.gamma?.toFixed(2)}`;
                updateElement('device-sensors', sensorData);
            }, { once: true });
            window.addEventListener('devicemotion', event => {
                sensorData = `Gia t·ªëc: X=${event.acceleration?.x?.toFixed(2)}, Y=${event.acceleration?.y?.toFixed(2)}, Z=${event.acceleration?.z?.toFixed(2)}`;
                updateElement('device-sensors', sensorData);
            }, { once: true });
            if (navigator.vibrate) {
                navigator.vibrate(100);
                sensorData += '; Rung: H·ªó tr·ª£';
                updateElement('device-sensors', sensorData);
            }
        }
        updateElement('device-sensors', sensorData);

        // Hi·ªáu Su·∫•t CPU/GPU
        const performanceResult = (function() {
            const start = performance.now();
            for (let i = 0; i < 2000000; i++) Math.sin(Math.random());
            const domStart = performance.now();
            const div = document.createElement('div');
            document.body.appendChild(div);
            document.body.removeChild(div);
            const end = performance.now();
            return `To√°n: ${(domStart - start).toFixed(2)} ms, DOM: ${(end - domStart).toFixed(2)} ms`;
        })();
        updateElement('performance-benchmark', performanceResult);

        // Danh S√°ch Plugin
        const plugins = navigator.plugins ? Array.from(navigator.plugins).map(p => p.name).join(', ') : 'Kh√¥ng c√≥';
        updateElement('navigator-plugins', plugins);

        // M√∫i Gi·ªù
        const timezoneOffset = new Date().getTimezoneOffset();
        updateElement('timezone-offset', `${timezoneOffset / -60} gi·ªù (UTC${timezoneOffset > 0 ? '-' : '+'}${Math.abs(timezoneOffset / 60)})`);

        // Ph√¥ng Ch·ªØ M·ªü R·ªông
        function detectFonts(fontList) {
            const fonts = fontList || ['Arial', 'Helvetica', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia', 'Comic Sans MS', 'Roboto', 'Open Sans', 'Lato'];
            const testFont = 'monospace';
            const span = document.createElement('span');
            span.style.fontSize = '72px';
            span.innerHTML = 'mmmmmmmmmmlli';
            span.style.position = 'absolute';
            span.style.left = '-9999px';
            document.body.appendChild(span);
            const defaultWidth = span.offsetWidth;
            span.style.fontFamily = testFont;
            const defaultHeight = span.offsetHeight;
            const availableFonts = [];
            fonts.forEach(font => {
                span.style.fontFamily = `"${font}",${testFont}`;
                if (span.offsetWidth !== defaultWidth || span.offsetHeight !== defaultHeight) {
                    availableFonts.push(font);
                }
            });
            document.body.removeChild(span);
            return availableFonts;
        }
        updateElement('extended-fonts', detectFonts().join(', ') || 'Kh√¥ng ph√°t hi·ªán');

        // Navigator Properties
        const navigatorProps = {
            vendor: navigator.vendor,
            product: navigator.product,
            oscpu: navigator.oscpu,
            buildID: navigator.buildID,
            appVersion: navigator.appVersion,
            appName: navigator.appName,
            appCodeName: navigator.appCodeName
        };
        updateElement('navigator-props', JSON.stringify(navigatorProps, null, 2));

        // Cross-Device Patterns
        function trackCrossDevicePatterns() {
            const sessionPatterns = JSON.parse(sessionStorage.getItem('sessionPatterns') || '{}');
            const now = Date.now();
            sessionPatterns[now] = {
                userAgent: navigator.userAgent,
                timezone: new Date().getTimezoneOffset(),
                language: navigator.language
            };
            sessionStorage.setItem('sessionPatterns', JSON.stringify(sessionPatterns));
            const sessions = Object.keys(sessionPatterns).length;
            updateElement('cross-device', `S·ªë phi√™n: ${sessions}, T√≠nh nh·∫•t qu√°n: ${sessions > 1 ? 'C√≥' : 'Kh√¥ng'}`);
        }
        trackCrossDevicePatterns();

        // Th√¥ng Tin Kh√°c
        updateElement('webrtc-enabled', navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? 'C√≥' : 'Kh√¥ng');
        updateElement('platform', navigator.platform || 'Kh√¥ng kh·∫£ d·ª•ng');
        updateElement('do-not-track', navigator.doNotTrack ? (navigator.doNotTrack === '1' ? 'B·∫≠t' : 'T·∫Øt') : 'Kh√¥ng thi·∫øt l·∫≠p');
        updateElement('webdriver', navigator.webdriver ? 'C√≥' : 'Kh√¥ng');
        updateElement('fonts-detected', detectFonts(['Arial', 'Helvetica']).join(', ') || 'Kh√¥ng ph√°t hi·ªán');

        // V·ªã Tr√≠ (Geolocation)
        function checkGeolocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => updateElement('geolocation', `Vƒ© ƒë·ªô: ${pos.coords.latitude.toFixed(2)}, Kinh ƒë·ªô: ${pos.coords.longitude.toFixed(2)}`),
                    () => updateElement('geolocation', 'Kh√¥ng c·∫•p quy·ªÅn ho·∫∑c l·ªói'),
                    { timeout: 5000 }
                );
            } else {
                updateElement('geolocation', 'Kh√¥ng h·ªó tr·ª£');
            }
        }
        checkGeolocation();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Thiết Bị Người Dùng</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f6fa;
            color: #2d3436;
        }
        h1 {
            text-align: center;
            color: #2f3542;
            font-size: 2em;
            margin-bottom: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .category {
            margin: 20px 0;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .category h2 {
            margin: 0 0 15px;
            color: #1e90ff;
            font-size: 1.6em;
            border-bottom: 2px solid #dfe4ea;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        th {
            background: #f1f2f6;
            width: 35%;
            font-weight: 600;
        }
        td {
            background: #fff;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #636e72;
            padding: 20px;
        }
        .error {
            color: #e74c3c;
        }
        @media (max-width: 768px) {
            th, td {
                display: block;
                width: 100%;
            }
            th {
                background: #dfe4ea;
            }
        }
    </style>
</head>
<body>
    <h1>Phân Tích Toàn Diện Thiết Bị Người Dùng</h1>
    <div class="container" id="output">
        <p class="loading">Đang thu thập và phân tích thông tin thiết bị...</p>
    </div>

    <script>
        async function getDeviceInfo() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = ''; // Xóa thông báo đang tải

            // Hàm thêm danh mục thông tin
            function addCategory(title, data) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.innerHTML = `<h2>${title}</h2>`;
                const table = document.createElement('table');
                for (const [label, value] of Object.entries(data)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<th>${label}</th><td>${value || 'Không có thông tin'}</td>`;
                    table.appendChild(row);
                }
                categoryDiv.appendChild(table);
                outputDiv.appendChild(categoryDiv);
            }

            // 1. Thông tin thiết bị và trình duyệt
            const ua = navigator.userAgent;
            const isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const browserData = {
                'Loại thiết bị': isMobile ? 'Điện thoại/Tablet' : 'Máy tính',
                'User Agent': ua,
                'Tên trình duyệt': navigator.appName,
                'Phiên bản trình duyệt': navigator.appVersion,
                'Ngôn ngữ trình duyệt': navigator.languages ? navigator.languages.join(', ') : navigator.language,
                'Cookie bật': navigator.cookieEnabled ? 'Có' : 'Không',
                'Nhà cung cấp': navigator.vendor,
                'Sản phẩm': navigator.product,
                'Do Not Track': navigator.doNotTrack || 'Không xác định',
                'Chế độ riêng tư': window.matchMedia('(prefers-reduced-data: reduce)').matches ? 'Có' : 'Không'
            };

            // 2. Hệ điều hành và nền tảng
            const platformData = {
                'Nền tảng': navigator.platform,
                'Hệ điều hành': navigator.userAgentData?.platform || navigator.oscpu || 'Không có thông tin',
                'Múi giờ': Intl.DateTimeFormat().resolvedOptions().timeZone,
                'Định dạng ngày giờ': new Intl.DateTimeFormat().format(new Date()),
                'Định dạng số': new Intl.NumberFormat().format(1234567.89)
            };

            // 3. Thông tin màn hình
            const screenData = {
                'Độ phân giải màn hình': `${window.screen.width}x${window.screen.height}`,
                'Kích thước khả dụng': `${window.screen.availWidth}x${window.screen.availHeight}`,
                'Độ sâu màu': window.screen.colorDepth,
                'Tỷ lệ pixel': window.devicePixelRatio,
                'Chiều rộng cửa sổ': window.innerWidth,
                'Chiều cao cửa sổ': window.innerHeight,
                'Góc xoay màn hình': window.screen.orientation ? window.screen.orientation.angle : 'Không có thông tin',
                'Loại màn hình': window.screen.orientation ? window.screen.orientation.type : 'Không có thông tin',
                'Chế độ tối': window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Có' : 'Không'
            };

            // 4. Thông tin phần cứng
            const hardwareData = {
                'Bộ nhớ thiết bị (GB)': navigator.deviceMemory || 'Không có thông tin',
                'Số lõi CPU': navigator.hardwareConcurrency || 'Không có thông tin',
                'Hỗ trợ cảm ứng': ('ontouchstart' in window || navigator.maxTouchPoints > 0) 
                    ? `Có (Tối đa ${navigator.maxTouchPoints} điểm chạm)` 
                    : 'Không',
                'Độ chính xác con trỏ': window.matchMedia('(pointer: fine)').matches ? 'Cao (chuột)' : 'Thấp (cảm ứng)'
            };

            // 5. Thông tin pin
            const batteryData = {};
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    batteryData['Mức pin'] = `${(battery.level * 100).toFixed(0)}%`;
                    batteryData['Đang sạc'] = battery.charging ? 'Có' : 'Không';
                    batteryData['Thời gian sạc đầy'] = battery.chargingTime ? `${battery.chargingTime} giây` : 'Không sạc';
                    batteryData['Thời gian sử dụng pin'] = battery.dischargingTime ? `${battery.dischargingTime} giây` : 'Không có thông tin';
                } else {
                    batteryData['Thông tin pin'] = 'API Pin không được hỗ trợ';
                }
            } catch (e) {
                batteryData['Lỗi pin'] = `<span class="error">${e.message}</span>`;
            }

            // 6. Thông tin mạng
            const networkData = {};
            try {
                if ('connection' in navigator) {
                    const conn = navigator.connection;
                    networkData['Loại mạng'] = conn.type || 'Không có thông tin';
                    networkData['Tốc độ mạng hiệu quả'] = conn.effectiveType || 'Không có thông tin';
                    networkData['Tốc độ tải xuống (Mbps)'] = conn.downlink || 'Không có thông tin';
                    networkData['Thời gian phản hồi (ms)'] = conn.rtt || 'Không có thông tin';
                    networkData['Chế độ tiết kiệm dữ liệu'] = conn.saveData ? 'Bật' : 'Tắt';
                    networkData['Công nghệ mạng'] = conn.downlinkMax ? `${conn.downlinkMax} Mbps` : 'Không có thông tin';
                } else {
                    networkData['Thông tin mạng'] = 'API Network Information không được hỗ trợ';
                }
            } catch (e) {
                networkData['Lỗi mạng'] = `<span class="error">${e.message}</span>`;
            }

            // 7. WebGL và GPU
            const webglData = {};
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    if (debugInfo) {
                        webglData['Nhà sản xuất GPU'] = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                        webglData['Bộ render GPU'] = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                    }
                    webglData['Phiên bản WebGL'] = gl.getParameter(gl.VERSION);
                    webglData['Shader Version'] = gl.getParameter(gl.SHADING_LANGUAGE_VERSION);
                    webglData['Số lượng texture tối đa'] = gl.getParameter(gl.MAX_TEXTURE_SIZE);
                    webglData['Độ chính xác cao nhất'] = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE).join(', ');
                } else {
                    webglData['WebGL'] = 'Không được hỗ trợ';
                }
            } catch (e) {
                webglData['Lỗi WebGL'] = `<span class="error">${e.message}</span>`;
            }

            // 8. WebGPU (nếu hỗ trợ)
            const webgpuData = {};
            try {
                if ('gpu' in navigator) {
                    const gpu = await navigator.gpu.requestAdapter();
                    webgpuData['Hỗ trợ WebGPU'] = gpu ? 'Có' : 'Không';
                    webgpuData['Tên adapter'] = gpu ? gpu.name || 'Không xác định' : 'Không có thông tin';
                } else {
                    webgpuData['Hỗ trợ WebGPU'] = 'Không được hỗ trợ';
                }
            } catch (e) {
                webgpuData['Lỗi WebGPU'] = `<span class="error">${e.message}</span>`;
            }

            // 9. Thiết bị đa phương tiện
            const mediaData = {};
            try {
                if ('mediaDevices' in navigator && navigator.mediaDevices.enumerateDevices) {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    mediaData['Số camera'] = devices.filter(device => device.kind === 'videoinput').length;
                    mediaData['Số microphone'] = devices.filter(device => device.kind === 'audioinput').length;
                    mediaData['Số loa'] = devices.filter(device => device.kind === 'audiooutput').length;
                    mediaData['Camera đầu tiên'] = devices.find(device => device.kind === 'videoinput')?.label || 'Không có thông tin';
                } else {
                    mediaData['Thiết bị đa phương tiện'] = 'Không được hỗ trợ';
                }
            } catch (e) {
                mediaData['Lỗi thiết bị đa phương tiện'] = `<span class="error">${e.message}</span>`;
            }

            // 10. Định vị
            const geoData = {};
            try {
                if ('geolocation' in navigator) {
                    geoData['Hỗ trợ định vị'] = 'Có (yêu cầu quyền truy cập)';
                } else {
                    geoData['Hỗ trợ định vị'] = 'Không được hỗ trợ';
                }
            } catch (e) {
                geoData['Lỗi định vị'] = `<span class="error">${e.message}</span>`;
            }

            // 11. Hiệu suất
            const perfData = {};
            try {
                const performance = window.performance || {};
                const timing = performance.timing || {};
                if (timing.navigationStart) {
                    perfData['Thời gian tải trang (ms)'] = timing.loadEventEnd - timing.navigationStart;
                    perfData['Thời gian xử lý DOM (ms)'] = timing.domContentLoadedEventEnd - timing.navigationStart;
                }
                if (performance.memory) {
                    perfData['Bộ nhớ JS Heap (MB)'] = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                    perfData['Giới hạn bộ nhớ JS (MB)'] = (performance.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);
                }
                perfData['Thời gian phản hồi mạng (ms)'] = timing.responseEnd - timing.requestStart || 'Không có thông tin';
            } catch (e) {
                perfData['Lỗi hiệu suất'] = `<span class="error">${e.message}</span>`;
            }

            // 12. Font enumeration (giả lập bằng canvas)
            const fontData = {};
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.font = '12px unknown';
                const defaultWidth = ctx.measureText('abcdefghijklmnopqrstuvwxyz0123456789').width;
                const fonts = [
                    'Arial', 'Helvetica', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia',
                    'Palatino', 'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS', 'Arial Black',
                    'Impact', 'Roboto', 'Open Sans', 'Lato', 'Montserrat'
                ];
                const detectedFonts = fonts.filter(font => {
                    ctx.font = `12px "${font}"`;
                    return ctx.measureText('abcdefghijklmnopqrstuvwxyz0123456789').width !== defaultWidth;
                });
                fontData['Font phát hiện'] = detectedFonts.length > 0 ? detectedFonts.join(', ') : 'Không phát hiện font';
                fontData['Tổng số font thử nghiệm'] = fonts.length;
                fontData['Số font phát hiện'] = detectedFonts.length;
            } catch (e) {
                fontData['Lỗi phát hiện font'] = `<span class="error">${e.message}</span>`;
            }

            // 13. Canvas Fingerprint
            const canvasData = {};
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(20, 20, 150, 100);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint Test 123', 30, 50);
                ctx.strokeStyle = 'rgba(0, 255, 0, 0.5)';
                ctx.beginPath();
                ctx.arc(100, 75, 50, 0, Math.PI * 2, true);
                ctx.stroke();
                canvasData['Canvas Fingerprint'] = canvas.toDataURL().slice(0, 50) + '...';
            } catch (e) {
                canvasData['Lỗi Canvas Fingerprint'] = `<span class="error">${e.message}</span>`;
            }

            // 14. AudioContext Fingerprint
            const audioData = {};
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    const ctx = new AudioContext();
                    const oscillator = ctx.createOscillator();
                    const compressor = ctx.createDynamicsCompressor();
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
                    compressor.threshold.setValueAtTime(-50, ctx.currentTime);
                    oscillator.connect(compressor);
                    compressor.connect(ctx.destination);
                    audioData['AudioContext'] = 'Hỗ trợ';
                    audioData['Tần số mẫu'] = ctx.sampleRate;
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 1); // Chỉ chạy ngắn để fingerprint
                } else {
                    audioData['AudioContext'] = 'Không được hỗ trợ';
                }
            } catch (e) {
                audioData['Lỗi AudioContext'] = `<span class="error">${e.message}</span>`;
            }

            // 15. Cảm biến thiết bị
            const sensorData = {};
            try {
                if ('AmbientLightSensor' in window) sensorData['Cảm biến ánh sáng'] = 'Có';
                if ('Accelerometer' in window) sensorData['Cảm biến gia tốc'] = 'Có';
                if ('Gyroscope' in window) sensorData['Cảm biến con quay'] = 'Có';
                if ('Magnetometer' in window) sensorData['Cảm biến từ trường'] = 'Có';
                if ('DeviceOrientationEvent' in window) sensorData['Sự kiện định hướng'] = 'Có';
                if ('DeviceMotionEvent' in window) sensorData['Sự kiện chuyển động'] = 'Có';
                if (Object.keys(sensorData).length === 0) sensorData['Cảm biến'] = 'Không có thông tin';
            } catch (e) {
                sensorData['Lỗi cảm biến'] = `<span class="error">${e.message}</span>`;
            }

            // 16. WebRTC
            const webrtcData = {};
            try {
                const rtc = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
                if (rtc) {
                    webrtcData['Hỗ trợ WebRTC'] = 'Có';
                    const pc = new rtc({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
                    pc.createDataChannel('test');
                    await pc.createOffer().then(offer => {
                        webrtcData['ICE Candidates'] = offer.sdp.includes('candidate') ? 'Có' : 'Không';
                    });
                    pc.close();
                } else {
                    webrtcData['Hỗ trợ WebRTC'] = 'Không';
                }
            } catch (e) {
                webrtcData['Lỗi WebRTC'] = `<span class="error">${e.message}</span>`;
            }

            // 17. Lịch sử điều hướng
            const historyData = {};
            try {
                historyData['Số trang trong lịch sử'] = window.history.length;
                historyData['Loại điều hướng'] = performance.navigation ? performance.navigation.type : 'Không có thông tin';
            } catch (e) {
                historyData['Lỗi lịch sử'] = `<span class="error">${e.message}</span>`;
            }

            // 18. Các tính năng trình duyệt
            const featureData = {
                'Hỗ trợ Service Worker': 'serviceWorker' in navigator ? 'Có' : 'Không',
                'Hỗ trợ WebAssembly': typeof WebAssembly === 'object' ? 'Có' : 'Không',
                'Hỗ trợ Notifications': 'Notification' in window ? 'Có' : 'Không',
                'Hỗ trợ Clipboard API': 'clipboard' in navigator ? 'Có' : 'Không',
                'Hỗ trợ Vibration API': 'vibrate' in navigator ? 'Có' : 'Không',
                'Hỗ trợ Web Share API': 'share' in navigator ? 'Có' : 'Không',
                'Hỗ trợ Credential Management': 'credentials' in navigator ? 'Có' : 'Không',
                'Hỗ trợ Web Authentication': 'PublicKeyCredential' in window ? 'Có' : 'Không'
            };

            // Thêm tất cả danh mục vào giao diện
            addCategory('Thông tin trình duyệt và thiết bị', browserData);
            addCategory('Hệ điều hành và nền tảng', platformData);
            addCategory('Thông tin màn hình', screenData);
            addCategory('Phần cứng', hardwareData);
            addCategory('Pin', batteryData);
            addCategory('Mạng', networkData);
            addCategory('WebGL và GPU', webglData);
            addCategory('WebGPU', webgpuData);
            addCategory('Thiết bị đa phương tiện', mediaData);
            addCategory('Định vị', geoData);
            addCategory('Hiệu suất', perfData);
            addCategory('Phát hiện font', fontData);
            addCategory('Canvas Fingerprint', canvasData);
            addCategory('Audio Fingerprint', audioData);
            addCategory('Cảm biến thiết bị', sensorData);
            addCategory('WebRTC', webrtcData);
            addCategory('Lịch sử điều hướng', historyData);
            addCategory('Tính năng trình duyệt', featureData);
        }

        // Chạy hàm khi trang tải
        window.onload = getDeviceInfo;
    </script>
</body>
</html>

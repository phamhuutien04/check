<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Thiết Bị Nghiêm Ngặt</title>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 20px;
            background-color: #f1f3f5;
            color: #212529;
        }
        h1 {
            text-align: center;
            color: #1e1e1e;
            font-size: 2.5em;
            margin-bottom: 30px;
        }
        .container {
            max-width: 1500px;
            margin: 0 auto;
        }
        .category {
            margin: 20px 0;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }
        .category h2 {
            margin: 0 0 15px;
            color: #007bff;
            font-size: 1.9em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        th {
            background: #e9ecef;
            width: 40%;
            font-weight: 600;
        }
        td {
            background: #ffffff;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #6c757d;
            padding: 20px;
        }
        .error {
            color: #dc3545;
        }
        .highlight {
            color: #28a745;
            font-weight: bold;
        }
        .probability {
            font-size: 1.2em;
            padding: 10px;
            background: #e7f5ff;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        @media (max-width: 768px) {
            th, td {
                display: block;
                width: 100%;
            }
            th {
                background: #ced4da;
            }
        }
    </style>
</head>
<body>
    <h1>Phân Tích Nghiêm Ngặt Thiết Bị Người Dùng</h1>
    <div class="container" id="output">
        <p class="loading">Đang thực hiện kiểm tra nghiêm ngặt thiết bị...</p>
    </div>

    <script>
        async function getDeviceInfo() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = ''; // Xóa thông báo đang tải

            let authenticityScore = 50; // Điểm xác thực ban đầu (50%)
            const authenticityFactors = [];

            // Hàm thêm danh mục thông tin
            function addCategory(title, data) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.innerHTML = `<h2>${title}</h2>`;
                const table = document.createElement('table');
                for (const [label, value] of Object.entries(data)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<th>${label}</th><td>${value || 'Không hỗ trợ'}</td>`;
                    table.appendChild(row);
                }
                categoryDiv.appendChild(table);
                outputDiv.appendChild(categoryDiv);
            }

            // Hàm thêm yếu tố xác thực
            function addAuthenticityFactor(description, scoreChange) {
                authenticityFactors.push({ description, scoreChange });
                authenticityScore = Math.min(100, Math.max(0, authenticityScore + scoreChange));
            }

            // Hàm xác định thiết bị cụ thể từ User Agent
            function detectDevice(ua) {
                let deviceType = 'Không xác định';
                let deviceModel = 'Không xác định';

                if (/iPhone/i.test(ua)) {
                    deviceType = 'iPhone';
                    const match = ua.match(/iPhone OS (\d+_\d+)/);
                    deviceModel = match ? `iPhone (iOS ${match[1].replace('_', '.')})` : 'iPhone';
                } else if (/iPad/i.test(ua)) {
                    deviceType = 'iPad';
                    const match = ua.match(/CPU OS (\d+_\d+)/);
                    deviceModel = match ? `iPad (iOS ${match[1].replace('_', '.')})` : 'iPad';
                } else if (/Android/i.test(ua)) {
                    deviceType = 'Android';
                    const match = ua.match(/Android \d+\.\d+.*?(?:; ([^;)]+))/);
                    deviceModel = match && match[1] ? `Android (${match[1]})` : 'Android';
                } else if (/Windows/i.test(ua)) {
                    deviceType = 'PC (Windows)';
                    deviceModel = 'PC';
                } else if (/Macintosh/i.test(ua)) {
                    deviceType = 'Mac';
                    deviceModel = 'Mac';
                } else if (/Linux/i.test(ua) && !/Android/i.test(ua)) {
                    deviceType = 'PC (Linux)';
                    deviceModel = 'PC';
                }

                return { deviceType, deviceModel };
            }

            // 1. Thông tin thiết bị và trình duyệt
            const ua = navigator.userAgent;
            const isMobileUA = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const { deviceType, deviceModel } = detectDevice(ua);
            const browserData = {
                'Loại thiết bị (User Agent)': isMobileUA ? 'Điện thoại/Tablet' : 'Máy tính',
                'Thiết bị cụ thể': deviceType,
                'Mô hình thiết bị': deviceModel,
                'User Agent': ua,
                'Tên trình duyệt': navigator.appName,
                'Phiên bản trình duyệt': navigator.appVersion,
                'Ngôn ngữ trình duyệt': navigator.languages ? navigator.languages.join(', ') : navigator.language,
                'Cookie bật': navigator.cookieEnabled ? 'Bật' : 'Tắt',
                'Nhà cung cấp': navigator.vendor,
                'Sản phẩm': navigator.product,
                'Do Not Track': navigator.doNotTrack || 'Không xác định',
                'Chế độ giảm dữ liệu': window.matchMedia('(prefers-reduced-data: reduce)').matches ? 'Bật' : 'Tắt',
                'Chế độ giảm chuyển động': window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'Bật' : 'Tắt'
            };

            // Kiểm tra giả mạo User Agent
            const uaBrands = navigator.userAgentData?.brands || [];
            const isConsistentUA = uaBrands.some(brand => ua.includes(brand.brand)) || !navigator.userAgentData;
            if (isConsistentUA) {
                addAuthenticityFactor('User Agent nhất quán với UserAgentData', 10);
            } else {
                addAuthenticityFactor('User Agent không nhất quán, có thể giả mạo', -20);
            }

            // 2. Thông tin LocalStorage (m_shareearn_finger, share_uuid)
            const localStorageData = {};
            try {
                const m_shareearn_finger = localStorage.getItem('m_shareearn_finger');
                const share_uuid = localStorage.getItem('share_uuid');
                localStorageData['m_shareearn_finger'] = m_shareearn_finger || 'Không tồn tại';
                localStorageData['share_uuid'] = share_uuid || 'Không tồn tại';

                if (m_shareearn_finger && m_shareearn_finger !== 'null') {
                    addAuthenticityFactor('Tồn tại m_shareearn_finger, phù hợp với thiết bị hợp lệ', 10);
                } else {
                    addAuthenticityFactor('Thiếu m_shareearn_finger, có thể là thiết bị mới hoặc giả mạo', -10);
                }

                if (share_uuid && share_uuid !== 'null') {
                    addAuthenticityFactor('Tồn tại share_uuid, phù hợp với thiết bị hợp lệ', 10);
                } else {
                    addAuthenticityFactor('Thiếu share_uuid, có thể là thiết bị mới hoặc giả mạo', -10);
                }
            } catch (e) {
                localStorageData['Lỗi LocalStorage'] = `<span class="error">${e.message}</span>`;
            }

            // 3. Hệ điều hành và nền tảng
            const platformData = {
                'Nền tảng': navigator.platform,
                'Hệ điều hành': navigator.userAgentData?.platform || navigator.oscpu || 'Không hỗ trợ',
                'Múi giờ': Intl.DateTimeFormat().resolvedOptions().timeZone,
                'Định dạng ngày giờ': new Intl.DateTimeFormat().format(new Date()),
                'Định dạng số': new Intl.NumberFormat().format(1234567.89),
                'Định dạng tiền tệ': new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(1234567.89)
            };

            // 4. Thông tin màn hình và loại màn hình
            const screenData = {};
            try {
                screenData['Độ phân giải màn hình'] = `${window.screen.width}x${window.screen.height}`;
                screenData['Kích thước khả dụng'] = `${window.screen.availWidth}x${window.screen.availHeight}`;
                screenData['Độ sâu màu'] = window.screen.colorDepth;
                screenData['Tỷ lệ pixel'] = window.devicePixelRatio;
                screenData['Chiều rộng cửa sổ'] = window.innerWidth;
                screenData['Chiều cao cửa sổ'] = window.innerHeight;
                screenData['Góc xoay màn hình'] = window.screen.orientation ? window.screen.orientation.angle : 'Không hỗ trợ';
                screenData['Loại hướng màn hình'] = window.screen.orientation ? window.screen.orientation.type : 'Không hỗ trợ';
                screenData['Chế độ tối'] = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Bật' : 'Tắt';

                // Suy ra loại màn hình
                const pixelRatio = window.devicePixelRatio;
                const resolution = window.screen.width * window.screen.height;
                const colorDepth = window.screen.colorDepth;
                let screenType = 'LCD';
                if (pixelRatio >= 2 && resolution >= 1920 * 1080 && colorDepth >= 24) {
                    screenType = 'Retina/OLED';
                    addAuthenticityFactor('Màn hình Retina/OLED, phù hợp thiết bị di động cao cấp', 5);
                } else if (pixelRatio >= 1.5 && resolution >= 1280 * 720) {
                    screenType = 'LED';
                    addAuthenticityFactor('Màn hình LED, phù hợp thiết bị trung cấp', 3);
                }
                if (isMobileUA && pixelRatio < 1.5) {
                    addAuthenticityFactor('Tỷ lệ pixel thấp, không phù hợp thiết bị di động hiện đại', -15);
                }
                screenData['Loại màn hình (ước tính)'] = `<span class="highlight">${screenType}</span>`;
            } catch (e) {
                screenData['Lỗi màn hình'] = `<span class="error">${e.message}</span>`;
            }

            // 5. Thông tin phần cứng
            const hardwareData = {};
            try {
                hardwareData['Bộ nhớ thiết bị'] = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Không hỗ trợ';
                hardwareData['Số lõi CPU'] = navigator.hardwareConcurrency || 'Không hỗ trợ';
                hardwareData['Hỗ trợ cảm ứng'] = ('ontouchstart' in window || navigator.maxTouchPoints > 0) 
                    ? `${navigator.maxTouchPoints} điểm chạm` 
                    : 'Không hỗ trợ';
                hardwareData['Độ chính xác con trỏ'] = window.matchMedia('(pointer: fine)').matches ? 'Cao (chuột)' : 'Thấp (cảm ứng)';
                hardwareData['Bàn phím ảo'] = 'virtualKeyboard' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ';

                // Kiểm tra cảm ứng thật
                if (isMobileUA && navigator.maxTouchPoints === 0) {
                    addAuthenticityFactor('Thiếu hỗ trợ cảm ứng, có thể là giả mạo thiết bị di động', -25);
                } else if (isMobileUA && navigator.maxTouchPoints >= 2) {
                    addAuthenticityFactor('Hỗ trợ cảm ứng đa điểm, phù hợp thiết bị di động', 15);
                }
            } catch (e) {
                hardwareData['Lỗi phần cứng'] = `<span class="error">${e.message}</span>`;
            }

            // 6. Thông tin pin
            const batteryData = {};
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    batteryData['Mức pin'] = `${(battery.level * 100).toFixed(2)}%`;
                    batteryData['Đang sạc'] = battery.charging ? 'Bật' : 'Tắt';
                    batteryData['Thời gian sạc đầy'] = battery.chargingTime ? `${battery.chargingTime} giây` : 'Không sạc';
                    batteryData['Thời gian sử dụng pin'] = battery.dischargingTime ? `${battery.dischargingTime} giây` : 'Không hỗ trợ';
                    if (isMobileUA && battery.level > 0) {
                        addAuthenticityFactor('Pin khả dụng, phù hợp thiết bị di động', 10);
                    }
                } else {
                    batteryData['API Pin'] = 'Không hỗ trợ';
                    if (isMobileUA) {
                        addAuthenticityFactor('Thiếu API Pin, bất thường cho thiết bị di động', -10);
                    }
                }
            } catch (e) {
                batteryData['Lỗi pin'] = `<span class="error">${e.message}</span>`;
            }

            // 7. Thông tin mạng
            const networkData = {};
            try {
                if ('connection' in navigator) {
                    const conn = navigator.connection;
                    networkData['Loại mạng'] = conn.type || 'Không hỗ trợ';
                    networkData['Tốc độ mạng hiệu quả'] = conn.effectiveType || 'Không hỗ trợ';
                    networkData['Tốc độ tải xuống'] = conn.downlink ? `${conn.downlink} Mbps` : 'Không hỗ trợ';
                    networkData['Thời gian phản hồi'] = conn.rtt ? `${conn.rtt} ms` : 'Không hỗ trợ';
                    networkData['Tốc độ tải xuống tối đa'] = conn.downlinkMax ? `${conn.downlinkMax} Mbps` : 'Không hỗ trợ';
                    networkData['Chế độ tiết kiệm dữ liệu'] = conn.saveData ? 'Bật' : 'Tắt';
                } else {
                    networkData['API Network Information'] = 'Không hỗ trợ';
                }
            } catch (e) {
                networkData['Lỗi mạng'] = `<span class="error">${e.message}</span>`;
            }

            // 8. WebGL và GPU
            const webglData = {};
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    webglData['Nhà sản xuất GPU'] = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Không hỗ trợ';
                    webglData['Bộ render GPU'] = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Không hỗ trợ';
                    webglData['Phiên bản WebGL'] = gl.getParameter(gl.VERSION);
                    webglData['Shader Version'] = gl.getParameter(gl.SHADING_LANGUAGE_VERSION);
                    webglData['Kích thước texture tối đa'] = gl.getParameter(gl.MAX_TEXTURE_SIZE);
                    webglData['Tiện ích mở rộng'] = gl.getSupportedExtensions().slice(0, 5).join(', ') + (gl.getSupportedExtensions().length > 5 ? '...' : '');
                    if (isMobileUA && gl.getParameter(gl.MAX_TEXTURE_SIZE) > 8192) {
                        addAuthenticityFactor('Texture WebGL lớn, bất thường cho thiết bị di động', -10);
                    }
                } else {
                    webglData['WebGL'] = 'Không hỗ trợ';
                }
            } catch (e) {
                webglData['Lỗi WebGL'] = `<span class="error">${e.message}</span>`;
            }

            // 9. WebGPU
            const webgpuData = {};
            try {
                if ('gpu' in navigator) {
                    const gpu = await navigator.gpu.requestAdapter();
                    webgpuData['Hỗ trợ WebGPU'] = gpu ? gpu.name || 'Hỗ trợ' : 'Không hỗ trợ';
                    webgpuData['Giới hạn tài nguyên'] = gpu ? JSON.stringify(gpu.limits, null, 2).slice(0, 50) + '...' : 'Không hỗ trợ';
                } else {
                    webgpuData['WebGPU'] = 'Không hỗ trợ';
                }
            } catch (e) {
                webgpuData['Lỗi WebGPU'] = `<span class="error">${e.message}</span>`;
            }

            // 10. Thiết bị đa phương tiện
            const mediaData = {};
            try {
                if ('mediaDevices' in navigator && navigator.mediaDevices.enumerateDevices) {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    mediaData['Số camera'] = devices.filter(device => device.kind === 'videoinput').length;
                    mediaData['Số microphone'] = devices.filter(device => device.kind === 'audioinput').length;
                    mediaData['Số loa'] = devices.filter(device => device.kind === 'audiooutput').length;
                    mediaData['Camera đầu tiên'] = devices.find(device => device.kind === 'videoinput')?.label || 'Không hỗ trợ';
                    if (isMobileUA && mediaData['Số camera'] > 0) {
                        addAuthenticityFactor('Có camera, phù hợp thiết bị di động', 5);
                    }
                } else {
                    mediaData['API Media Devices'] = 'Không hỗ trợ';
                    if (isMobileUA) {
                        addAuthenticityFactor('Thiếu API Media Devices, bất thường cho thiết bị di động', -10);
                    }
                }
            } catch (e) {
                mediaData['Lỗi thiết bị đa phương tiện'] = `<span class="error">${e.message}</span>`;
            }

            // 11. Định vị
            const geoData = {};
            try {
                geoData['API Geolocation'] = 'geolocation' in navigator ? 'Hỗ trợ (yêu cầu quyền)' : 'Không hỗ trợ';
                if (isMobileUA && 'geolocation' in navigator) {
                    addAuthenticityFactor('Hỗ trợ Geolocation, phù hợp thiết bị di động', 5);
                }
            } catch (e) {
                geoData['Lỗi định vị'] = `<span class="error">${e.message}</span>`;
            }

            // 12. Hiệu suất
            const perfData = {};
            try {
                const performance = window.performance || {};
                const timing = performance.timing || {};
                if (timing.navigationStart) {
                    perfData['Thời gian tải trang'] = `${timing.loadEventEnd - timing.navigationStart} ms`;
                    perfData['Thời gian xử lý DOM'] = `${timing.domContentLoadedEventEnd - timing.navigationStart} ms`;
                    perfData['Thời gian phản hồi mạng'] = `${timing.responseEnd - timing.requestStart} ms`;
                }
                if (performance.memory) {
                    perfData['Bộ nhớ JS Heap'] = `${(performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`;
                    perfData['Giới hạn bộ nhớ JS'] = `${(performance.memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB`;
                }
                perfData['Loại điều hướng'] = performance.navigation ? ['Tải mới', 'Quay lại', 'Chuyển tiếp'][performance.navigation.type] || 'Không hỗ trợ' : 'Không hỗ trợ';
            } catch (e) {
                perfData['Lỗi hiệu suất'] = `<span class="error">${e.message}</span>`;
            }

            // 13. Font enumeration
            const fontData = {};
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.font = '12px unknown';
                const defaultWidth = ctx.measureText('abcdefghijklmnopqrstuvwxyz0123456789').width;
                const fonts = [
                    'Arial', 'Helvetica', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia', 'Palatino', 'Garamond',
                    'Bookman', 'Comic Sans MS', 'Trebuchet MS', 'Arial Black', 'Impact', 'Roboto', 'Open Sans', 'Lato',
                    'Montserrat', 'Ubuntu', 'Source Sans Pro', 'Merriweather', 'Poppins', 'Raleway', 'Noto Sans', 'Futura',
                    'Segoe UI', 'Calibri', 'Candara', 'Optima', 'Baskerville', 'Didot', 'Franklin Gothic', 'Gill Sans',
                    'Consolas', 'Monaco', 'Menlo', 'Inconsolata', 'DIN Next Pro', 'Avenir', 'Proxima Nova'
                ];
                const detectedFonts = fonts.filter(font => {
                    ctx.font = `12px "${font}"`;
                    return ctx.measureText('abcdefghijklmnopqrstuvwxyz0123456789').width !== defaultWidth;
                });
                fontData['Font phát hiện'] = detectedFonts.length > 0 ? detectedFonts.join(', ') : 'Không phát hiện';
                fontData['Số font thử nghiệm'] = fonts.length;
                fontData['Số font phát hiện'] = detectedFonts.length;
                if (isMobileUA && detectedFonts.includes('Segoe UI')) {
                    addAuthenticityFactor('Font hệ thống máy tính (Segoe UI) phát hiện, có thể giả mạo', -15);
                }
            } catch (e) {
                fontData['Lỗi phát hiện font'] = `<span class="error">${e.message}</span>`;
            }

            // 14. Canvas Fingerprint
            const canvasData = {};
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 300;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                ctx.font = '18px Arial';
                ctx.fillStyle = 'rgba(255, 99, 71, 0.8)';
                ctx.fillRect(10, 10, 200, 100);
                ctx.fillStyle = '#4682b4';
                ctx.fillText('Strict Fingerprint Test', 20, 50);
                ctx.strokeStyle = '#32cd32';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(150, 150, 40, 0, Math.PI * 2);
                ctx.stroke();
                const gradient = ctx.createLinearGradient(0, 0, 200, 0);
                gradient.addColorStop(0, '#ff4500');
                gradient.addColorStop(1, '#00ced1');
                ctx.fillStyle = gradient;
                ctx.fillRect(50, 120, 100, 50);
                canvasData['Canvas Fingerprint'] = canvas.toDataURL().slice(0, 50) + '...';
            } catch (e) {
                canvasData['Lỗi Canvas Fingerprint'] = `<span class="error">${e.message}</span>`;
            }

            // 15. Audio Fingerprint
            const audioData = {};
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    const ctx = new AudioContext();
                    const oscillator = ctx.createOscillator();
                    const compressor = ctx.createDynamicsCompressor();
                    const analyser = ctx.createAnalyser();
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(440, ctx.currentTime);
                    compressor.threshold.setValueAtTime(-70, ctx.currentTime);
                    oscillator.connect(compressor);
                    compressor.connect(analyser);
                    analyser.connect(ctx.destination);
                    audioData['Tần số mẫu'] = ctx.sampleRate;
                    audioData['Kích thước FFT'] = analyser.fftSize;
                    audioData['Kênh âm thanh'] = ctx.destination.channelCount;
                    audioData['Tần số oscillator'] = oscillator.frequency.value;
                    oscillator.start();
                    setTimeout(() => oscillator.stop(), 1);
                    ctx.close();
                    if (isMobileUA) {
                        addAuthenticityFactor('AudioContext hỗ trợ, phù hợp thiết bị di động', 5);
                    }
                } else {
                    audioData['AudioContext'] = 'Không hỗ trợ';
                }
            } catch (e) {
                audioData['Lỗi AudioContext'] = `<span class="error">${e.message}</span>`;
            }

            // 16. Cảm biến thiết bị
            const sensorData = {};
            try {
                sensorData['Cảm biến ánh sáng'] = 'AmbientLightSensor' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Cảm biến gia tốc'] = 'Accelerometer' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Cảm biến con quay'] = 'Gyroscope' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Cảm biến từ trường'] = 'Magnetometer' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Cảm biến áp suất'] = 'Barometer' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Sự kiện định hướng'] = 'DeviceOrientationEvent' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                sensorData['Sự kiện chuyển động'] = 'DeviceMotionEvent' in window ? 'Hỗ trợ' : 'Không hỗ trợ';
                const hasMobileSensors = 'Accelerometer' in window || 'Gyroscope' in window || 'DeviceMotionEvent' in window;
                if (isMobileUA && hasMobileSensors) {
                    addAuthenticityFactor('Cảm biến di động hỗ trợ, xác nhận thiết bị di động thật', 20);
                } else if (isMobileUA && !hasMobileSensors) {
                    addAuthenticityFactor('Thiếu cảm biến di động, có thể giả mạo thiết bị di động', -30);
                }
            } catch (e) {
                sensorData['Lỗi cảm biến'] = `<span class="error">${e.message}</span>`;
            }

            // 17. WebRTC
            const webrtcData = {};
            try {
                const rtc = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
                if (rtc) {
                    const pc = new rtc({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
                    pc.createDataChannel('test');
                    const offer = await pc.createOffer();
                    webrtcData['ICE Candidates'] = offer.sdp.includes('candidate') ? offer.sdp.split('\n').filter(line => line.includes('candidate')).join('; ') : 'Không hỗ trợ';
                    webrtcData['SDP Offer'] = offer.sdp.slice(0, 50) + '...';
                    pc.close();
                    if (isMobileUA) {
                        addAuthenticityFactor('WebRTC hỗ trợ, phù hợp thiết bị di động', 5);
                    }
                } else {
                    webrtcData['WebRTC'] = 'Không hỗ trợ';
                }
            } catch (e) {
                webrtcData['Lỗi WebRTC'] = `<span class="error">${e.message}</span>`;
            }

            // 18. Lịch sử điều hướng
            const historyData = {};
            try {
                historyData['Số trang trong lịch sử'] = window.history.length;
                historyData['Loại điều hướng'] = performance.navigation ? ['Tải mới', 'Quay lại', 'Chuyển tiếp'][performance.navigation.type] || 'Không hỗ trợ' : 'Không hỗ trợ';
                historyData['Số lần chuyển hướng'] = performance.navigation ? performance.navigation.redirectCount : 'Không hỗ trợ';
            } catch (e) {
                historyData['Lỗi lịch sử'] = `<span class="error">${e.message}</span>`;
            }

            // 19. Hành vi người dùng
            const behaviorData = {};
            try {
                let keyEvents = 0, mouseEvents = 0, touchEvents = 0;
                document.addEventListener('keydown', () => keyEvents++, { once: true });
                document.addEventListener('mousemove', () => mouseEvents++, { once: true });
                document.addEventListener('touchstart', () => touchEvents++, { once: true });
                await new Promise(resolve => setTimeout(resolve, 1000)); // Chờ 1 giây
                behaviorData['Sự kiện bàn phím'] = keyEvents;
                behaviorData['Sự kiện chuột'] = mouseEvents;
                behaviorData['Sự kiện cảm ứng'] = touchEvents;
                behaviorData['Thời gian tải trang'] = performance.now().toFixed(2) + ' ms';
                if (isMobileUA && touchEvents > 0 && mouseEvents === 0) {
                    addAuthenticityFactor('Hành vi cảm ứng thuần, xác nhận thiết bị di động', 15);
                } else if (isMobileUA && mouseEvents > 0 && touchEvents === 0) {
                    addAuthenticityFactor('Hành vi chuột trên thiết bị di động, có thể giả mạo', -20);
                }
            } catch (e) {
                behaviorData['Lỗi hành vi'] = `<span class="error">${e.message}</span>`;
            }

            // 20. Phát hiện giả mạo (DevTools, kích thước cửa sổ)
            const spoofData = {};
            try {
                spoofData['DevTools mở'] = window.outerWidth - window.innerWidth > 100 || window.outerHeight - window.innerHeight > 100 ? 'Có thể' : 'Không';
                spoofData['Kích thước cửa sổ bất thường'] = window.innerWidth > window.screen.width || window.innerHeight > window.screen.height ? 'Có' : 'Không';
                if (spoofData['DevTools mở'] === 'Có thể' || spoofData['Kích thước cửa sổ bất thường'] === 'Có') {
                    addAuthenticityFactor('Phát hiện dấu hiệu DevTools hoặc giả mạo cửa sổ', -30);
                }
            } catch (e) {
                spoofData['Lỗi phát hiện giả mạo'] = `<span class="error">${e.message}</span>`;
            }

            // 21. Tính năng trình duyệt
            const featureData = {
                'Service Worker': 'serviceWorker' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ',
                'WebAssembly': typeof WebAssembly === 'object' ? 'Hỗ trợ' : 'Không hỗ trợ',
                'Notifications': 'Notification' in window ? 'Hỗ trợ' : 'Không hỗ trợ',
                'Clipboard API': 'clipboard' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ',
                'Vibration API': 'vibrate' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ',
                'Web Share API': 'share' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ',
                'WebXR': 'xr' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ',
                'WebCrypto': 'crypto' in window ? 'Hỗ trợ' : 'Không hỗ trợ',
                'Gamepad API': 'getGamepads' in navigator ? 'Hỗ trợ' : 'Không hỗ trợ'
            };
            if (isMobileUA && featureData['Vibration API'] === 'Hỗ trợ') {
                addAuthenticityFactor('Vibration API hỗ trợ, phù hợp thiết bị di động', 5);
            }

            // 22. CSS Media Queries
            const cssData = {};
            try {
                cssData['Mức zoom'] = window.matchMedia('(min-device-pixel-ratio: 2)').matches ? 'Cao' : 'Bình thường';
                cssData['Chế độ in'] = window.matchMedia('print').matches ? 'Bật' : 'Tắt';
                cssData['Màn hình cảm ứng'] = window.matchMedia('(hover: none)').matches ? 'Có' : 'Không';
                cssData['Độ sáng màn hình'] = window.matchMedia('(light-level: dim)').matches ? 'Tối' : 'Sáng';
                if (isMobileUA && cssData['Màn hình cảm ứng'] === 'Có') {
                    addAuthenticityFactor('CSS xác nhận màn hình cảm ứng, phù hợp thiết bị di động', 10);
                }
            } catch (e) {
                cssData['Lỗi CSS'] = `<span class="error">${e.message}</span>`;
            }

            // Hiển thị xác suất thiết bị thật
            const probabilityDiv = document.createElement('div');
            probabilityDiv.className = 'probability';
            probabilityDiv.innerHTML = `Xác suất thiết bị thật: <span class="highlight">${authenticityScore.toFixed(0)}%</span><br>` +
                `Yếu tố xác thực:<ul>` + authenticityFactors.map(f => `<li>${f.description}: ${f.scoreChange > 0 ? '+' : ''}${f.scoreChange}%</li>`).join('') + `</ul>`;
            outputDiv.appendChild(probabilityDiv);

            // Thêm tất cả danh mục
            await Promise.all([
                addCategory('Thông tin trình duyệt và thiết bị', browserData),
                addCategory('Thông tin LocalStorage', localStorageData),
                addCategory('Hệ điều hành và nền tảng', platformData),
                addCategory('Thông tin màn hình', screenData),
                addCategory('Phần cứng', hardwareData),
                addCategory('Pin', batteryData),
                addCategory('Mạng', networkData),
                addCategory('WebGL và GPU', webglData),
                addCategory('WebGPU', webgpuData),
                addCategory('Thiết bị đa phương tiện', mediaData),
                addCategory('Định vị', geoData),
                addCategory('Hiệu suất', perfData),
                addCategory('Phát hiện font', fontData),
                addCategory('Canvas Fingerprint', canvasData),
                addCategory('Audio Fingerprint', audioData),
                addCategory('Cảm biến thiết bị', sensorData),
                addCategory('WebRTC', webrtcData),
                addCategory('Lịch sử điều hướng', historyData),
                addCategory('Hành vi người dùng', behaviorData),
                addCategory('Phát hiện giả mạo', spoofData),
                addCategory('Tính năng trình duyệt', featureData),
                addCategory('CSS Media Queries', cssData)
            ]);
        }

        // Chạy hàm khi trang tải
        window.onload = getDeviceInfo;
    </script>
</body>
</html>
